<h1>Uploading to Steam</h1>
Below is a guide to using SteamPipe, Valve's tool for delivering content to Steam. For more information on best practices for updating your game, see <a href="https://partner.steamgames.com/doc/store/updates" class="bb_doclink">Updating Your Game</a>.<h2 class="bb_section"><a name="Introduction"></a>Introduction to the SteamPipe Content System</h2>SteamPipe is the game/application content system that powers Steam. SteamPipe includes the following features:<br><ul class="bb_ul ">	<li> Efficient and fast content delivery.<br>	</li><li> Unlimited public and private "beta" branches, allowing multiple builds to be tested.<br>	</li><li> Simple web-based management of builds - push out a new build or rollback to a previous build with just a few clicks.<br>	</li><li> Ability to see the update size of a build before setting it live.<br>	</li><li> Ability to share content between multiple applications.<br>	</li><li> Ability to <a href="#Building_Retail_Install_Discs" class="bb_doclink">build installer discs</a> from public or beta content.<br>	</li><li> Games/apps stay available offline even after an update download has been started.<br>	</li><li> All content is always encrypted, and non-active versions are not visible to customers.<br>	</li><li> A <a href="https://partner.steamgames.com/doc/sdk/uploading/local_content_server" class="bb_doclink">SteamPipe Local Content Server</a> which can be used during development.</li></ul><div class="bb_callout bb_yellow"><div><strong>NOTE:</strong> There are a few concepts which are integral to SteamPipe, before getting started you should be familiar with all of the concepts outlined in the <a href="https://partner.steamgames.com/doc/store/application" class="bb_doclink">Applications</a> documentation. Having even a basic understanding of how these pieces fit together will be very useful when uploading your product to Steam.</div></div><h2 class="bb_section"><a name="BuildingYourGameTutorial"></a>Steamworks Video Tutorial - Building Your Game in Steampipe</h2>This tutorial introduces SteamPipe and steps through building a sample application for Steam via the Steamworks tools.<br><a href="https://www.youtube.com/watch?v=SoNH-v6aU9Q" target="_blank" rel="noreferrer" id="dynamiclink_0">https://www.youtube.com/watch?v=SoNH-v6aU9Q</a><h2 class="bb_section"><a name="AddingPlatformsAndLanguagesTutorial"></a>Steamworks Video Tutorial - Adding New Platforms and Languages</h2>This tutorial walks you through adding new platforms and languages to your game by adding depots to your app.<br><a href="https://www.youtube.com/watch?v=PShS32hcing" target="_blank" rel="noreferrer" id="dynamiclink_1">https://www.youtube.com/watch?v=PShS32hcing</a><h4>SteamPipe Technical Details</h4>SteamPipe uses the HTTP protocol for content delivery. Since downloads are regular web traffic, any third-party HTTP cache between the customer and Steam servers will increase download speed. Content can be hosted by external CDN providers, which can be easily added to our content network. Most consumer firewalls allow HTTP traffic and won't block downloads.<br><br>SteamPipe has an efficient patching algorithm based on binary deltas, only changing the modified portions of existing content files. When this content is updated, only these deltas need be sent. This means both developer and user transfers are smaller and faster. Most partners will find that using a <a href="https://partner.steamgames.com/doc/sdk/uploading/local_content_server" class="bb_doclink">SteamPipe Local Content Server</a> not necessary since they can efficiently patch builds on private branches.<h2 class="bb_section"><a name="Build_Account"></a>Steam Build Account</h2>Before you can create any builds on Steam, you must have a Steam account in your Steamworks account with the "Edit App Metadata" and "Publish App Changes To Steam" permissions granted. For security reasons it's recommended that you have a dedicated build account with just those permissions, you may create a new Steam account for this purpose at <a href="https://store.steampowered.com/join" target="_blank" rel="noreferrer">https://store.steampowered.com/join</a>.<br><br>Any administrator of your Steamworks account can add a Steam account and grant the necessary permissions. More information on this process can be found in the <a href="https://partner.steamgames.com/doc/gettingstarted/managing_users" class="bb_doclink">Managing Your Steamworks Account</a> documentation. An example of what this account might look like is:<br><br><img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/steamworks_docs/english/create_build_account.png" alt="create_build_account.png" title="create_build_account.png"><h2 class="bb_section"><a name="Initial_Setup_New_App"></a>Initial Setup for New SteamPipe Apps</h2>Follow these steps to set up new SteamPipe apps:<br><ol class="bb_ol ">	<li> Find the app ID for your application (this can be found by selecting the application on your homepage in Steamworks)<br>	</li><li> Go to the <a href="https://partner.steamgames.com/apps/config/" target="_blank" rel="noreferrer">General Installation Settings</a> page for your app.<br>	</li><li> Define at least one launch option (the path and optionally, any arguments required to launch the game). Hover over the (?) to learn more about each field.<br><br>		The example below shows 4 launch options, 2 for Windows and 1 each for MacOS and Linux. Launch option 3 will only be shown on Windows if the user also owns the DLC specified.<br><br>		<img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/steamworks_docs/english/updatedlaunchoptions.png" alt="updatedlaunchoptions.png" title="updatedlaunchoptions.png"><br>	</li><li> Go to the <a href="https://partner.steamgames.com/apps/depots/" target="_blank" rel="noreferrer">Depots</a> page and add depots as needed for this app. By default, a depot may already be configured for your application.<br>		<ol class="bb_ol ">			<li> Click the default depot and change the name of the depot to a proper and recognizable name (such as "Base Content" or "Windows Content").<br>			</li><li> Leave the language set to [All language] unless this is a language-specific depot.<br>			</li><li> Leave the OS set to [All OSes] unless this is an OS-specific depot (if the app is all-in-one, or is just PC or just Mac, it should be left to [All OSes]. Only specify for OS-specific game depots.<br>			</li><li> Click <strong>Add New Depot</strong> to create additional depots.<br>			</li><li> Click <strong>Save Changes</strong> to save any changes made.<br>		</li></ol>	</li><li> Once you are done defining your depots, publish the changes that you have made from the <a href="https://partner.steamgames.com/apps/publishing" target="_blank" rel="noreferrer">Publish</a> page.<br>	</li><li> Your newly defined depots will need to be included in a package to grant you ownership of them. Each game on Steam should have a Developer Comp package which is automatically granted to the accounts listed within your publisher group.<br>		You can add the new depots to that package (and/or other packages that should have these depots) on the <a href="https://partner.steamgames.com/apps/associated" target="_blank" rel="noreferrer">Associated Packages &amp; DLC</a> page.</li></ol><div class="bb_callout "><div>Note: If your executable is in a sub-folder of the main installation folder, add the sub-folder name in the Executable field. Don't use leading slashes or dots.</div></div><h2 class="bb_section"><a name="1"></a>Setting up the SDK for SteamPipe uploads</h2>Download and unzip the latest version of the Steamworks SDK on the machine you will be uploading builds on.<br><br>The SteamPipe tools can be found within the SDK in the <code class="bb_code bb_code_inline nohighlight">tools</code> folder which contains 2 relevant sub-directories. <br><br>The <code class="bb_code bb_code_inline nohighlight">ContentBuilder</code> directory is where your game content and SteamPipe build tools will live. This directory contains the following sub-directories:<br><ul class="bb_ul ">	<li> <strong>builder</strong> - This directory initially contains just steamcmd.exe which is the command line version of Steam.<br>	</li><li> <strong>builder_linux</strong> - The linux version of steamcmd.<br>	</li><li> <strong>builder_osx</strong> - The macOS version of steamcmd.<br>	</li><li> <strong>content</strong> - This directory contains all game files that will be built into depots.<br>	</li><li> <strong>output</strong> - This directory will be the location for build logs, chunk cache, and intermediate output. <strong>NOTE:</strong> This folder can be deleted or emptied at any time, but after it's deleted, the next upload time will take longer.<br>	</li><li> <strong>scripts</strong> - This directory is where you'll place all of your build scripts for building your game depots.</li></ul><img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/steamworks_docs/english/steampipebuilddir.png" alt="steampipebuilddir.png" title="steampipebuilddir.png"><br><br>It's recommended that you run steamcmd.exe directly in the builder folder for your platform once to bootstrap your build system. This should populate your builder directory with all the files it needs to build depots.<br><br>The <code class="bb_code bb_code_inline nohighlight">ContentServer</code> directory contains the tools for running your own <a href="https://partner.steamgames.com/doc/sdk/uploading/local_content_server" class="bb_doclink">SteamPipe Local Content Server</a> if you choose to do so.<h2 class="bb_subsection"><a name="2"></a>SteamCmd on macOS</h2>To enable SteamCmd on macOS you must complete the following steps:<br><ol class="bb_ol ">	<li> From the terminal, browse to the tools\ContentBuilder\builder_osx\osx32 folder<br>	</li><li> Run chmod +x steamcmd<br>	</li><li> Browse up to the parent folder (tools\ContentBuilder\builder_osx)<br>	</li><li> Type bash ./steamcmd.sh<br>	</li><li> SteamCmd will then run and update to the latest build, leaving you in the SteamCmd prompt<br>	</li><li> Type exit and press return to exit the prompt</li></ol>You can then follow the rest of this documentation (substituting paths as appropriate) to create depot and app config files for uploading your content to Steam.<h2 class="bb_section"><a name="3"></a>Creating SteamPipe Build Config Files</h2>To upload your app with SteamPipe, you must create scripts which describe your build and each depot that will be included in it. There are simple example scripts in the <code class="bb_code bb_code_inline nohighlight">ContentBuilder\scripts</code> folder for an app with one depot.<br><br><strong>NOTE:</strong> You can name these scripts what ever you want, but we use the names <code class="bb_code bb_code_inline nohighlight">app_build_&lt;AppID&gt;</code> and <code class="bb_code bb_code_inline nohighlight">depot_build_&lt;AppID&gt;</code> for consistency. If you know that you'll be building apps on this machine, it might be a good idea to create sub-directories in your scripts directory for each application, to help organize each application's build scripts.<h2 class="bb_subsection"><a name="steampipe_gui_tool"></a>SteamPipe GUI Tool</h2>If you're running on Windows and would prefer a GUI tool to help create these config files and upload your builds you can use the SteamPipeGUI which is available in the tools folder of the Steamworks SDK. Included in the zip are additional instructions to get you started.<br><br>If you choose to use the GUI tool then reading the following sections is still recommended to help you become more familiar with how the SteamPipe system works.<h2 class="bb_subsection"><a name="4"></a>Depot Build Script</h2>First create a depot build script for each depot you are wanting to upload. Start by duplicating the <code class="bb_code bb_code_inline nohighlight">depot_build_1001.vdf</code> script and renaming it with the depot ID that it will be uploading.<br><br>Example depot build script:<br><div class="bb_code ">"DepotBuildConfig"
{
	// Set the depot ID that this script will upload.
	"DepotID" "1001"

	// Set a root for all content.
	// All relative paths specified below (LocalPath in FileMapping entries, and FileExclusion paths)
	// will be resolved relative to this root.
	// If you don't define ContentRoot, then it will be assumed to be
	// the location of this script file, which probably isn't what you want
	"ContentRoot"	"D:\MyGame\rel\master\"

	// Include all files recursively
	"FileMapping"
	{
		// This can be a full path, or a path relative to ContentRoot
		"LocalPath" "*"

		// This is a path relative to the install folder of your game
		"DepotPath" "."

		// If LocalPath contains wildcards, setting this means that all
		// matching files within subdirectories of LocalPath will also
		// be included.
		"recursive" "1"
	}

	// Exclude all symbol files
	// This can be a full path, or a path relative to ContentRoot
	"FileExclusion" "*.pdb"
}
</div><br><strong>NOTE:</strong> Setting a "ContentRoot" in the depot build script will override the "ContentRoot" in the app build script.<h2 class="bb_subsection"><a name="5"></a>App Build Script</h2>After setting up your Depot build scripts you will need an App build script which describes the details of the build. Start by duplicating the <code class="bb_code bb_code_inline nohighlight">app_build_1000.vdf</code> script and renaming it with the app ID that it will be building.<br><br>The following types of builds supported by SteamPipe:<br><ul class="bb_ul ">	<li> Preview - This type of build only outputs logs and a file manifest. Building preview builds is a good way to iterate on your upload scripts.<br>	</li><li> Local - Builds for the <a href="https://partner.steamgames.com/doc/sdk/uploading/local_content_server" class="bb_doclink">SteamPipe Local Content Server</a>. LCS builds upload to your own LCS and allow you to test the installation of your game using the Steam client.<br>	</li><li> SteamPipe - SteamPipe builds result in your depots actually being uploaded to Steam. This is always safe to do, even for games that are already released, as you will need to set it public before customers can download it.</li></ul><br>Example app build script:<br><div class="bb_code ">"appbuild"
{
	// Set the app ID that this script will upload.
	"appid" "1000"

	// The description for this build.
	// The description is only visible to you in the 'Your Builds' section of the App Admin panel.
	// This can be changed at any time after uploading a build on the 'Your Builds' page.
	"desc" "Your build description here"

	// Enable/Disable whether this a preview build.
	// It's highly recommended that you use preview builds while doing the initially setting up SteamPipe to
	// ensure that the depot manifest contains the correct files.
	"preview" "1"

	// File path of the local content server if it's enabled.
	"local" ""

	// Branch name to automatically set live after successful build, none if empty.
	// Note that the 'default' branch can not be set live automatically. That must be done through the App Admin panel.
	"setlive" ""


	// The following paths can be absolute or relative to location of the script.

	// This directory will be the location for build logs, chunk cache, and intermediate output.
	// The cache stored within this causes future SteamPipe uploads to complete quicker by using diffing.
	//
	// NOTE: for best performance, use a separate disk for your build output. This splits the disk IO workload, letting your content root
	// disk handle the read requests and your output disk handle the write requests. 
	"buildoutput" "e:\build_logs\output\"

	// The root of the content folder.
	"contentroot" "..\content\"

	// The list of depots included in this build.
	"depots"
	{
		"1001" "depot_build_1001.vdf"
	}
}
</div><h2 class="bb_section"><a name="Building_Depots"></a>Building Depots</h2>To kick off a build, edit the run_build.bat file to include your Steamworks build account and password (see <a href="#Build_Account" class="bb_doclink">above</a>) and path to the app build script:<br><div class="bb_code ">builder\steamcmd.exe +login "account" "password" +run_app_build ..\scripts\[build_script_name].vdf +quit
</div><br><strong>NOTE:</strong> Your first attempt at running a build may fail due to Steam Guard. If the logon fails due to Steam Guard, check your email for the Steam Guard code, and run steamcmd as: <code class="bb_code bb_code_inline nohighlight">steamcmd.exe "set_steam_guard_code &lt;code&gt;"</code>, and try again. After logging in with Steam Guard once, a sentry file is used to verify the login is genuine.<br><br>If you are using steamcmd from a machine or VM that gets re-imaged frequently, you should include the sentry and config file in your image so you won't be prompted for a Steam Guard every time. The sentry file is located in &lt;Steam&gt;\ssfn&lt;hashOfNumbers&gt;, and the config file is located in &lt;Steam&gt;\config\config.vdf.<br><br>After you run run_build.bat, your build output should be in the directory specified in your build script file. If the preview build produces the expected manifest, run the build again with "preview" "0" in your app build script.<br><br>The following steps occur during a SteamPipe build:<br><ol class="bb_ol ">	<li> Steamcmd.exe is logging into the Steam backend using the given builder Steam account.<br>	</li><li> The app build start is registered with the MDS (Master Depot Server), which will ensure the user has the proper privileges to modify this app.<br>	</li><li> For each depot included in the app build, a file list is generated based on the files in the content folder and the filter rules defined in depot build config file.<br>	</li><li> Each file is scanned and divided into small chunks of about 1MB. If the depot has been built before, this partitioning will preserve as many of the unchanged chunks as possible.<br>	</li><li> New file chunks are compressed, encrypted, and then uploaded to the MDS.<br>	</li><li> A final manifest is generated for this depot version; each manifest is identified by a unique 64-bit manifest ID.<br>	</li><li> Once all depots have been processed, the MDS finishes this app build and assigns it a global buildID.<br>	</li><li> After the build is done, there may be *.csm and *.csd files in the build ouput folder. These are temporary and can be deleted, but they speed up subsequent build times.</li></ol><h2 class="bb_section"><a name="Managing_Updates"></a>Managing Updates</h2>After your app releases to customers, your customers will be receiving the build marked as the Default build. When uploading a new build it's always a good idea to test it before shipping it to your customers, for more information on how to successfully do this see <a href="https://partner.steamgames.com/doc/store/testing" class="bb_doclink">Testing On Steam</a>.<h2 class="bb_section"><a name="Advanced_File_Mapping"></a>Advanced File Mapping Rules</h2>There can be multiple file mappings that add files to the depot. They should be listed first.<br>Files or subfolders can be excluded with filter expressions.<br>Steam <a href="https://partner.steamgames.com/doc/sdk/installscripts" class="bb_doclink">install scripts</a> can be marked during the build process so the Steam client knows to run them for any application which mounts the Depot.<br>Files or folders can be remapped, so sub-folders in the content folder can be mapped to anywhere in the depot.<br>Files can be tagged with special flags:<br><ul class="bb_ul ">	<li> <strong>userconfig</strong> - This file is modified by the user or game. It cannot be overridden by an update, and it won't trigger a verification error if it's different from the previous version of the file.<br>	</li><li> <strong>versionedconfig</strong> - Similar to userconfig, however if the file is updated in the depot, it will be overwritten locally when the user's game updates. Only update the file in the depot when there is a necessary format change or bug fix.<br>		<div class="bb_code ">"DepotBuildConfig"
{
	"DepotID" "202931"

	"FileMapping"
	{
		// override video files files in \\videos with German versions
		"LocalPath" "localization\\german\\videos\\*"
		"DepotPath" "videos\\"
	}

	"FileMapping"
	{
		// override audio files in \\audio with German versions
		"LocalPath" "localization\\german\\audio\\*"
		"DepotPath" "audio\\"
	}

	"FileMapping"
	{
		"LocalPath" "localization\\german\\german_installscript.vdf"
		"DepotPath" "."
	}

	"FileExclusion" "bin\\server.exe" // exclude this file
	"FileExclusion" "*.pdb" // exclude all .PDB files everywhere
	"FileExclusion" "maps\\testroom*" // exclude all files under maps/testroom/

	"InstallScript" "localization\\german\\german_installscript.vdf"

	"FileProperties"
	{
		"LocalPath" "bin\\setup.cfg"
		"Attributes" "userconfig" // this file will be modified during runtime
	}
}
	</div></li></ul><h2 class="bb_section"><a name="Debugging_Build_Issues"></a>Debugging Build Issues</h2>If your build wasn't successful, you should look in your output directory for error information, not the console where the build script was run. Most error information can be found in the *.log files.<br>You can use these Steam client commands and client-side files to debug issues:<br><ul class="bb_ul ">	<li> <code class="bb_code bb_code_inline nohighlight">"app_status [appid]"</code> - Shows the current state of the app on this client.<br>	</li><li> <code class="bb_code bb_code_inline nohighlight">"app_info_print [appid]"</code> - Shows the current Steamworks configuration for this game (depots, launch options, etc.).<br>	</li><li> <code class="bb_code bb_code_inline nohighlight">"app_config_print [appid]"</code> - Shows the current user configuration for this game (current language, install directory, etc.).<br>	</li><li> <code class="bb_code bb_code_inline nohighlight">file "logs\content_log.txt"</code> - Lists all logged Oxcart operations and errors.<br>	</li><li> <code class="bb_code bb_code_inline nohighlight">file "steamapps\appmanifest_[appid].acf"</code> - Shows the current install state of this app (KeyValues).</li></ul><h2 class="bb_section"><a name="Building_Efficient_Depots"></a>Building Efficient Depots for SteamPipe</h2>The old Steam content system would patch updates on a file level, which meant that if a single byte in a file changed, the entire new file would be downloaded by all users. This was especially inefficient if the game used pack files, which are collections of game content files in a single big file. Pack files can easily exceed 1 GB, so updates often led to unnecessarily large downloads. A common way to avoid these large downloads was to add new pack files that overrode content of already shipped pack files. That worked for updates, but it hurt new users long-term, since they ended up downloading unused, already-patched content.<br><br>The new content system fixes this problem by splitting each file into roughly 1-MB chunks. Each chunk is then compressed and encrypted before being distributed by the Steam content system. If the game content has large redundant parts, these chunks are reused and the user only has to download each repeated chunk once. However, the real strength of this system is building efficient update patches. While the system is building a patch, the new content is scanned for already known chunks. If it finds them, it reuses them. This means if you change or inject a few bytes in a big file, the user only has to download the changes.<br><br>This works well in most cases, but there are still a few pitfalls that need to be avoided when designing the content layout of a game. You may not want to compress or encrypt your game data. This is already done for in-flight downloads and retail discs by the Steam content system. If you do it too, it can reduce the effectiveness of delta patching. Compression and encryption are only advised if each individual asset within a package file is separately compressed and/or encrypted. Otherwise, a change to one asset will always require downloading several other potentially unchanged assets.<br><br>If you package multiple assets in a single pack file, make sure that with each re-packaging, no unnecessary changes are made. One problematic practice is including the full name of the original source files on disk, because the names may change, depending on the build machine. Another bad pattern is including build time stamps for each file. If possible, always add new content to the end of your pack files and keep the order of existing files. Also, keep your pack file’s metadata (offset and sizes to individual assets) in one place and don’t intersperse it with the asset data. Use a binary difference tool like BeyondCompare to look at two builds of your pack files to make sure that hundreds of unwanted changes don’t show up.<br><br>If you follow these rules you will minimize patch sizes and only new content will need to be downloaded. Your customers will thank you for that and you will be able to increase the quality of your product by shipping more updates.<br><br>If you suspect that your game packaging is not interacting well with the SteamPipe update process, please contact your Valve representative and we can look into enabling advanced features to help with this.<h2 class="bb_section"><a name="Building_Retail_Install_Discs"></a>Building Retail Install Discs</h2>To build retail install disc for SteamPipe games, you must first setup a build project file.<br>In this example, the SKU file is called "sku_goldmaster.txt":<br><div class="bb_code ">"sku"
{
	"name" "Test Game Installer"
	"appid" "202930"
	"disk_size_mb"          "640"
	"included_depots"
	{
		"1"     "202931"
		"2"     "202932"
	}
}
</div>Some tips to keep in mind:<br><ul class="bb_ul ">	<li> Create a new folder where the retail disc images will be written to, e.g., "D:\retail_disks". Only depots in the included_depots sections are added; there is no exclude section anymore.<br>	</li><li> You can use Steam.exe (with the -dev and -console command-line parameters) or steamcmd.exe to build installer images. In both cases, use the "build_installer" command.<br>	</li><li> Log on with a Steam account that owns the game and all depots you want to put on the retail disc. Otherwise, the account doesn't need special rights, so anyone can build installer discs.<br>	</li><li> If you use Steam.exe, stop all other downloads.<br>	</li><li> Go to the console page and run the build_installer command:<br>		<div class="bb_code ">build_installer sku_goldmaster.txt "D:\retail_disks"
		</div>		The build can take a while since all depots are re-downloaded the first time.<br>	</li><li> If you're building a GM using a local content server, run:<br>		<code class="bb_code bb_code_inline nohighlight">    @localcontentserver "webserver"</code><br>		<code class="bb_code bb_code_inline nohighlight">    build_installer sku_goldmaster.txt "D:\retail_disks" local</code><br>		The spew refers to 'Backup' since 'Retail install Disk' and local game backups are basically the same.<br>	</li><li> Once you see "Backup finished for AppID...", the install disk images are ready. You can find more details about the backup build in <code class="bb_code bb_code_inline nohighlight">logs\backup_log.txt</code>.<br>	</li><li> There are new folders (Disk_1, Disk_2, and so on) in "D:\retail_disks", each not bigger than 640 MB, as specified with "disk_size_mb". Each disk folder contains a "sku.sis" file and a .csd and .csm for each depot. Bigger depots span across multiple disks. All retail install disk content is always encrypted (unlike local game backup files). Copy the SDK GM setup files (setup.exe, setup.ini, etc.) into the folder of your first disk and the retail disc installer is complete.<br>	</li><li> When creating a GM for OSX, be sure to open the goldmaster/disk_assets/SteamRetailInstaller.dmg image on a Mac. Then take the app that is in there and copy it to the root of your media. You will probably want to change the name of the install app, brand the icon and decorate the window to only show the installer.<br>	</li><li> When creating a multi-disc GM for OSX, be sure the volume name for each disc matches. The volume name becomes part of the mount path, and if the names don't match the installer won't be able to find the next disc.</li></ul><h2 class="bb_subsection"><a name="6"></a>Optionally building a retail installer from a beta branch</h2>The process above will create a retail installer based on the default branch. If you need to create an installer based on a beta branch, you must first create a beta branch named "baseline". Then use the following command to build from the baseline branch:<br><div class="bb_code ">build_installer &lt;project file&gt; &lt;target folder&gt; &lt;beta key&gt; &lt;beta pwd&gt;
steamcmd ex: build_installer sku_goldmaster.txt "D:\retail_disks" baseline superSecret
script ex: steamcmd.exe +login user_name password +build_installer "..\Build\GameDataSku.txt" c:\destination beta_key beta_password +exit
</div><h2 class="bb_subsection"><a name="7"></a>Installing DLC from a retail installer</h2>In some circumstances, you may wish to create a retail installer that includes your DLC packages. In such cases, the process to create the installer requires only a few changes.<br>In "sku_goldmaster.txt", include the DLC AppIDs under the "included_depots" section. Once you have run the "build_installer" process, find the generated sku.sis file for the installer and open it with a text editor.<br>Add the DLC AppID in the "apps" section. For example, if I had a game with AppID 1000 and DLC AppID 1010, I would adjust the "apps" section as follows:<br><div class="bb_code ">	"apps"
	{
		"0"	"1000"
		"1"	"1010"
	}
</div>This will ensure that Steam checks for ownership of the DLC and prompt the user for a key if the DLC is not owned by the account that they are logging into on Steam.<h2 class="bb_subsection"><a name="8"></a>Building a retail installer for multiple App IDs on a single disc/install package</h2>To build a GM containing multiple Steam Pipe apps. Build each app installer one by one but point them all to the same output folder. Each build will merge itself with the already existing install image.<h2 class="bb_subsection"><a name="9"></a>Customizing a Retail install disk</h2>See <a href="https://partner.steamgames.com/doc/sdk/goldmaster" class="bb_doclink">Customizing a gold master</a> for more details on customizing your retail install disk.<h2 class="bb_section"><a name="Preloading"></a>Preloading Games before Release</h2>By default, all content is always encrypted, on all retail discs and on all content servers. Switching a game to preload mode means owners can download the content, but it stays encrypted on the users' disk and can't be played. Once the game becomes officially released, Steam will decrypt the preloaded content and the user can play the game.<br><br>Switching a game to preload mode is recommended in these cases:<br><ul class="bb_ul ">	<li> Shipping retail discs with product keys before the game is actually available (0-day piracy).<br>	</li><li> Games that run a pre-purchase and are larger than 20GBs in size.</li></ul><br>Please submit a ticket to Steam Publishing if you believe your game requires preloading.<h2 class="bb_section"><a name="Building_DLC"></a>Building DLC</h2>DLC is built as a depot of the base game. See the <a href="https://partner.steamgames.com/doc/store/application/dlc" class="bb_doclink">Downloadable Content (DLC)</a> documentation for more information.<h2 class="bb_section"><a name="Troubleshooting_SteamPipe"></a>Troubleshooting SteamPipe</h2><h4>"Login Failure: Account Logon Denied Failed" when logging in via steamcmd</h4>Cause: Probably SteamGuard is preventing login. Resolution:<br><ul class="bb_ul ">	<li> Check the email associated with the account you are trying to log on with and look for an email from Steam Support. Copy the code from that email.<br>	</li><li> Run the following steamcmd: <code class="bb_code bb_code_inline nohighlight">set_steam_guard_code &lt;code&gt;</code><br>	</li><li> Re-Attempt logon from steamcmd: <code class="bb_code bb_code_inline nohighlight">Steam&gt;logon &lt;buildaccount&gt; &lt;password&gt;</code></li></ul><h4>General Troubleshooting for Download Issues</h4><ul class="bb_ul ">	<li> Restart computer, modem, router, etc.<br>	</li><li> Verify firewall settings. The new system requires port 80 (HTTP) and all other Steam ports, listed <a href="https://support.steampowered.com/kb_article.php?ref=8571-GLVN-8711" target="_blank" rel="noreferrer">here</a>.<br>	</li><li> Temporarily disable local Anti-Virus or Spam-Blocker programs.<br>	</li><li> Check the Steam download region under <strong>Settings</strong>-&gt;<strong>Downloads</strong>. It should match your location.<br>	</li><li> Stop the download, uninstall, and reinstall the game (clear manifest caches).<br>	</li><li> Exit Steam, delete the two folders appcache and depotcache in your Steam install folder.<br>	</li><li> Try to set your Steam download region to some other location far away. This might work if a content server near you is serving bad data.</li></ul><h4>My Mac and/or Linux Builds aren't installing any files. Why?</h4>If you're testing via Steam the installation of your game or application across multiple platforms, you may run into a situation where the build deploys on Windows but doesn't deploy any files on Mac or Linux despite your SteamPipe process being setup to upload Mac and/or Linux depots. There is a step that is easily missed which involves adding your alternate Depots to the Package being deployed. You can check what depots are included in a package via the following steps:<br><ol class="bb_ol ">	<li> Navigate to your <i>App Admin</i> page<br>	</li><li> From the View Associated Items section, click <i>View Demo, all associated packages, videos, and DLC</i><br>	</li><li> Click on the title of the Package you're attempting to download<br>	</li><li> Review the <i>Depots Included</i> section<br>	</li><li> Use the <i>Add/Remove Depots</i> to ensure the correct set of Depots are assigned to the Package</li></ol>There are a number of discussion threads about this that may also assist:<br><ul class="bb_ul ">	<li> <a href="http://steamcommunity.com/groups/steamworks/discussions/0/864972621123948611" target="_blank" rel="noreferrer">Empty folder after installing the game</a><br>	</li><li> <a href="http://steamcommunity.com/groups/steamworks/discussions/0/540742667593104506" target="_blank" rel="noreferrer">Unity Builds for PC/Mac/Linux</a><br>	</li><li> <a href="http://steamcommunity.com/groups/steamworks/discussions/0/540742667672176633" target="_blank" rel="noreferrer">Preparing Content for Mac Packaging</a></li></ul><h4>Running steamcmd.exe results in the following error: "SteamUpdater: Error: Steam needs to be online to update. Please confirm your network connection and try again."</h4>Resolution: Go to <strong>Internet Options</strong>-&gt;<strong>Connections</strong>-&gt;<strong>Lan Settings</strong> and check <strong>Automatically detect settings</strong>.<h4>Running the app build results in the following error: "ERROR! Failed 'DepotBuild for scriptname.vdf' - status = 6."</h4>Possible Causes:<br><ul class="bb_ul ">	<li> Account does not have permissions for the app.<br>		<ul class="bb_ul ">			<li> Check that the app ID is correct in the app_build.vdf.<br>			</li><li> Check that the build account has <a href="#Build_Account" class="bb_doclink">proper permissions</a> to the app ID.<br>		</li></ul>	</li><li> Steamcmd cannot find the depot contents.<br>		<ul class="bb_ul ">			<li> Check that the "contentroot" value in the app_build script is a valid path relative to the location of the script file.<br>			</li><li> Check that the "LocalPath" value in the depot_build script is a valid path relative to the path in the app_build script. Check that the path contains actual content.<br>		</li></ul></li></ul><h4>Running the app build results in the following error: "ERROR! Failed to get application info for app NNNNN (check login and subscription)"</h4>This means that Steam can't retrieve information about the app, either because it doesn't exist or the user doesn't have access to the app.<br><ul class="bb_ul ">	<li> Check that the NNNNN is the app ID you were assigned for the app.<br>	</li><li> Check that the app ID is correct in the app_build.vdf.<br>	</li><li> If it is a new app ID, check that the Steamworks app admin configuration has been published. New apps should have a Steam Pipe install directory on the config tab, a depot on the depot tab, and all changes published on the publish tab.<br>	</li><li> If all of that looks right, make sure that your account owns the app ID.</li></ul><h4>"An error occurred while installing [AppName] (Invalid content configuration)" at launch time</h4>Possible Causes:<br><ul class="bb_ul ">	<li> No build has been set live on the branch you're trying to install from.<br>		Resolution: Set your build live on a branch by going to <a href="https://partner.steamgames.com/apps/builds/&lt;YourGameAppId&gt;" target="_blank" rel="noreferrer">https://partner.steamgames.com/apps/builds/&lt;YourGameAppId&gt;</a>, and select that branch in the Steam client (as described <a href="#Building_Depots" class="bb_doclink">here</a>).<br>	</li><li> Invalid game launch options.<br>		Resolution: Verify the launch options on the Configuration tab in the app admin for your game <a href="https://partner.steamgames.com/apps/config/&lt;YourGameAppId&gt;" target="_blank" rel="noreferrer">https://partner.steamgames.com/apps/config/&lt;YourGameAppId&gt;</a>.<br>	</li><li> You don't own the Depot IDs that make up the game.<br>		Resolution: Make sure the necessary depots are added to the development subscription (See <a href="https://partner.steamgames.com/doc/store/application/packages#editing_packages" class="bb_doclink">Editing packages</a> for additional details).</li></ul><h4>"Error code 15" at launch time</h4>This is the CEG servers rejecting the request to CEG the exe. Check the release state on the game page. If it is not 'playable', you will need to request Steam keys that override the release state.<h4>"The Steam Servers are too busy to handle your request... Error Code (2)" at launch time</h4>This is the CEG servers failing to find a matching CEG exe. Double check that you have a working CEG executable on the CEG tab of your app admin. Click the 'status' button to make sure that it's propped.<h4>I can't remember what that steamcmd command was or how it worked</h4>Use the 'find' command in steamcmd to search for any steamcmd command. It will do partial matching on the command name and it will list out the command syntax.<br><div class="bb_code nohighlight">Steam&gt;find build_installer
ConVars:
Commands:
build_installer : &lt;project file&gt; &lt;target folder&gt; &lt;beta key&gt; &lt;beta pwd&gt;
</div>
